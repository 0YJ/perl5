#!./miniperl

@ARGV = "./config.sh";

open STDOUT, ">lib/Config.pm"
    or die "Can't open lib/Config.pm: $!\n";
$myver = sprintf("%.3f", $]);
print <<"ENDOFBEG";
package Config;
require Exporter;
\@ISA = (Exporter);
\@EXPORT = qw(%Config);

\$] == $myver or die sprintf
    "Perl lib version ($myver) doesn't match executable version (%.3f)\\n", \$];

ENDOFBEG

while (<>) {
    s:^#!/bin/sh::;
    s/'undef'/undef/;	# So we can say "if $Config{'foo'}".
    s/=true$/='true'/;	# Catch CONFIG=true line from Configure.
    s/^(\w+)=/\$Config{'$1'} = /;
    s/$/;/ unless (/^#/ || /^$/);
    print $_;
}
print "1;\n";
exit 0;
